/*!
 * gobang v1.0.0
 * gobang game
 * https://passer-by.com/gobang/
 *
 * Copyright (c) 2024-present, HaoLe Zheng
 *
 * Released under the MIT License
 * https://github.com/mumuy/gobang
 *
 * Created on: 2024-09-20
 */
!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e){var n=function(e,n){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"===t(n)?n:String(n)}function n(t,n,r){return(n=e(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,e(o.key),o)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function s(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,a(t,e,"get"))}function c(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,a(t,e,"set"),n),n}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}function h(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return l(e)}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}function y(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var g=function(){function t(e){r(this,t),n(this,"events",{}),this.id=t.id++}return i(t,[{key:"on",value:function(t,e){void 0===this.events[t]&&(this.events[t]=[]);var n=Math.random().toString(16).substring(2);return this.events[t].push({id:n,type:t,handler:e}),n}},{key:"off",value:function(t){var e,n=y(this.events);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.events[r]=this.events[r].filter((function(e){return e.id!=t}))}}catch(t){n.e(t)}finally{n.f()}}}]),t}();function p(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d(t);if(e){var o=d(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}n(g,"id",0);var x=function(t){f(n,t);var e=p(n);function n(t){var o;return r(this,n),(o=e.call(this)).config=Object.assign({x:0,y:0,pxWidth:20,data:[],xLength:0,yLength:0,frames:1,times:0,dynamic:!0,isHover:!1,coord:null,update:function(){},draw:function(){}},t),Object.assign(l(o),o.config),o.data=structuredClone(o.config.data),o.xLength=o.data.length,o.yLength=o.data[0].length,o}return i(n,[{key:"coord2position",value:function(t,e){return{x:this.x+t*this.pxWidth+this.pxWidth/2,y:this.y+e*this.pxWidth+this.pxWidth/2}}},{key:"position2coord",value:function(t,e){var n=Math.abs(t-this.x)%this.pxWidth-this.pxWidth/2,r=Math.abs(e-this.y)%this.pxWidth-this.pxWidth/2;return{x:Math.floor((t-this.x)/this.pxWidth),y:Math.floor((e-this.y)/this.pxWidth),offset:Math.sqrt(n*n+r*r)}}},{key:"setValue",value:function(t,e,n){var r;void 0!==(null===(r=this.data)||void 0===r||null===(r=r[t])||void 0===r?void 0:r[e])&&(this.data[t][e]=n)}},{key:"getValue",value:function(t,e){var n;return(null===(n=this.data)||void 0===n||null===(n=n[t])||void 0===n?void 0:n[e])||!1}}]),n}(g);function m(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d(t);if(e){var o=d(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var b=function(t){f(n,t);var e=m(n);function n(t){var o;return r(this,n),(o=e.call(this)).config=Object.assign({type:"item",x:0,y:0,width:20,height:20,align:["left","top"],status:1,zindex:0,orientation:0,speed:0,isHover:!1,location:null,coord:null,vector:null,frames:1,times:0,control:{},dynamic:!0,update:function(){},draw:function(){}},t),Object.assign(l(o),o.config),o.coord&&o.setCoord(o.coord.x,o.coord.y),o}return i(n,[{key:"setCoord",value:function(t,e){this.coord={x:t,y:e},this.location&&Object.assign(this,this.location.coord2position(this.coord.x,this.coord.y))}},{key:"setVector",value:function(t,e){this.vector={x:t,y:e}}}]),n}(g);function w(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d(t);if(e){var o=d(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return h(this,n)}}var k=function(t){f(n,t);var e=w(n);function n(t){var o;return r(this,n),(o=e.call(this)).config=Object.assign({status:0,maps:[],items:[],backgroundColor:"#000",update:function(){}},t),o.index=n.index++,Object.assign(l(o),o.config),o.maps=structuredClone(o.config.maps),o.items=structuredClone(o.config.items),o}return i(n,[{key:"createItem",value:function(t){var e=new b(t);return e.location&&Object.assign(e,e.location.coord2position(e.coord.x,e.coord.y)),e.stage=this,this.items.push(e),this.items.sort((function(t,e){return t.zindex-e.zindex})),e}},{key:"resetItems",value:function(){this.items.forEach((function(t){Object.assign(t,t.config),t.location&&Object.assign(t,t.location.coord2position(t.coord.x,t.coord.y))}))}},{key:"clearItems",value:function(t){this.items=t?this.items.filter((function(e){return e.type!=t})):[]}},{key:"getItems",value:function(t){return t?this.items.filter((function(e){return e.type==t})):this.items}},{key:"createMap",value:function(t){var e=new x(t);return e.data=structuredClone(e.config.data),e.yLength=e.data.length,e.xLength=e.data[0].length,e.imageData=null,e.stage=this,this.maps.push(e),e}},{key:"resetMaps",value:function(){this.maps.forEach((function(t){Object.assign(t,t.config),t.data=structuredClone(t.config.data),t.yLength=t.data.length,t.xLength=t.data[0].length,t.imageData=null}))}},{key:"clearMaps",value:function(){this.maps=[]}},{key:"reset",value:function(){for(var t in this.config)["maps","items"].includes(t)||(this[t]=this.config[t]);this.status=1,this.resetItems(),this.resetMaps()}}]),n}(g);function S(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function O(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}n(k,"index",0);var j=new WeakMap,P=new WeakMap,T=new WeakMap,E=new WeakMap,M=new WeakMap,z=function(){function t(e,o){r(this,t),O(this,j,{writable:!0,value:null}),O(this,P,{writable:!0,value:null}),O(this,T,{writable:!0,value:null}),O(this,E,{writable:!0,value:[]}),O(this,M,{writable:!0,value:0}),this.config=Object.assign({width:960,height:640},o),Object.assign(this,this.config),this.$canvas=document.getElementById(e),this.$canvas.width=this.config.width,this.$canvas.height=this.config.height,this.context=this.$canvas.getContext("2d"),c(this,j,document.createElement("canvas")),s(this,j).width=this.config.width,s(this,j).height=this.config.height,c(this,P,s(this,j).getContext("2d"));var i=this;["click","keydown","keyup","mousemove"].forEach((function(t){window.addEventListener(t,(function(e){var r=i.getPosition(e),o=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?S(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({type:t},r);s(i,E).forEach((function(e){if(1==e.status&&r.x>=0&&r.y>=0&&r.x<=i.$canvas.width&&r.y<=i.$canvas.height){e.events[t]&&e.events[t].forEach((function(t){t.handler(o)}));var n=null;e.maps.forEach((function(e){var o=e.xLength*e.pxWidth,i=e.yLength*e.pxWidth;"mousemove"==t&&(e.isHover=!1),1==e.status&&r.x>=e.x&&r.x<=e.x+o&&r.y>=e.y&&r.y<=e.y+i&&(e.isHover=!0,n=e)})),n&&n.events[t]&&n.events[t].forEach((function(t){t.handler(o)}));var a=null;e.items.forEach((function(e){var n=e.x;"center"==e.align[0]?n-=e.width/2:"right"==e.align[0]&&(n-=e.width);var o=e.y;"center"==e.align[1]?o-=e.height/2:"bottom"==e.align[1]&&(o-=e.height),"mousemove"==t&&(e.isHover=!1),1==e.status&&n<=r.x&&r.x<=n+e.width&&o<=r.y&&r.y<=o+e.height&&(e.isHover=!0,a=e)})),a&&a.events[t]&&a.events[t].forEach((function(t){t.handler(o)}))}}))}))}))}return i(t,[{key:"start",value:function(){var t=this,e=0;c(t,T,requestAnimationFrame((function n(){var r=t.getStage();r.status=1,t.context.clearRect(0,0,t.width,t.height),t.context.fillStyle=r.backgroundColor,t.context.fillRect(0,0,t.width,t.height),e++,0!=r.update()&&(r.maps.forEach((function(n){e%n.frames||(n.times=e/n.frames),n.dynamic?(n.update(),n.draw(t.context)):(t.context.save(),n.update(),s(t,P).clearRect(0,0,t.width,t.height),n.draw(s(t,P)),t.context.drawImage(s(t,j),0,0,t.width,t.height),t.context.restore())})),r.items.forEach((function(n){e%n.frames||(n.times=e/n.frames),n.dynamic?(1==r.status&&2!=n.status&&n.update(),n.draw(t.context)):(t.context.save(),n.update(),s(t,P).clearRect(0,0,t.width,t.height),n.draw(s(t,P)),t.context.drawImage(s(t,j),0,0,t.width,t.height),t.context.restore())}))),c(t,T,requestAnimationFrame(n))})))}},{key:"stop",value:function(){s(this,T)&&cancelAnimationFrame(s(this,T))}},{key:"getPosition",value:function(t){var e=this,n=e.$canvas.getBoundingClientRect();return{x:t.clientX-n.left*(e.width/n.width),y:t.clientY-n.top*(e.height/n.height)}}},{key:"createStage",value:function(t){var e=new k(t);return s(this,E).push(e),e}},{key:"setStage",value:function(t){s(this,E)[s(this,M)].status=0,c(this,M,t);var e=s(this,E)[s(this,M)];return e.status=1,e.reset(),e}},{key:"getStage",value:function(){return s(this,E)[s(this,M)]}},{key:"nextStage",value:function(){var t;if(s(this,M)<s(this,E).length-1)return this.setStage(c(this,M,(t=s(this,M),++t)));throw new Error("unfound new stage.")}},{key:"getStages",value:function(){return s(this,E)}},{key:"init",value:function(){c(this,M,0),this.start()}}]),t}(),C=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O"],W=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],A=["empty","computer","player"];function I(t){return Math.floor(t/60).toString().padStart(2,"0")+":"+Math.floor(t%60).toString().padStart(2,"0")}function R(t,e){var n=e.x,r=e.y,o=e.width,i=e.height,a=e.radius,s=void 0===a?8:a,c=e.color,l=void 0===c?"rgba(0,0,0,0.1)":c;t.save(),t.beginPath(),t.fillStyle=l,t.roundRect(n,r,o,i,s),t.closePath(),t.fill(),t.restore()}function L(t,e){var n=e.x,r=e.y,o=e.size,i=e.color,a=e.text;a&&(t.save(),t.beginPath(),t.fillStyle="rgba(0,0,0,0.1)",t.arc(n,r,.55*o,0,2*Math.PI),t.closePath(),t.fill(),t.restore());var s=t.createRadialGradient(n,r-.15*o,.1*o,n,r,o);"white"==i?(s.addColorStop(0,"#ffffff"),s.addColorStop(.6,"#bababa")):(s.addColorStop(0,"#484848"),s.addColorStop(.6,"#000000")),t.save(),t.beginPath(),t.fillStyle=s,t.arc(n,r,.475*o,0,2*Math.PI),t.closePath(),t.fill(),t.beginPath();var c=t.createRadialGradient(n,r-.3*o,.05*o,n,r-.35*o,.45*o);c.addColorStop(0,"rgba(255,255,255,0.15)"),c.addColorStop(1,"rgba(255,255,255,0.005)"),t.fillStyle=c,t.arc(n,r,.475*o,0,2*Math.PI),t.closePath(),t.fill(),a&&(t.fillStyle="white"==i?"#111111":"#eeeeee",t.font="bold 18px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(a,n,r)),t.restore()}function B(t,e){var n=e.x,r=e.y,o=e.size,i=e.text,a=e.align,s=void 0===a?"center":a,c=e.color,l=void 0===c?"#ffffff":c,u=e.isStroke,f=void 0===u||u;t.save(),t.strokeStyle="#355149",t.fillStyle=l,t.font="bold ".concat(o,"px Arial"),t.textAlign=s,t.textBaseline="middle",t.lineWidth=Math.floor(o/4),f&&t.strokeText(i,n,r),t.fillText(i,n,r),t.restore()}function D(t,e){var n=e.x,r=e.y,o=e.size,i=e.text,a=e.color,s=void 0===a?"#ffffff":a;t.save(),R(t,{x:n,y:r-.85*o,width:3.6*o,height:1.6*o,radius:.3*o,color:"rgba(0,0,0,0.5)"}),B(t,{x:n+1.8*o,y:r,size:o,text:i,color:s,isStroke:!1}),t.restore()}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function H(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return V(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return V(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function V(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var F=[{key:"11111",value:9e5},{key:"011110",value:9e4},{key:"1011101",value:9e4},{key:"11011011",value:9e4},{key:"111010111",value:9e4},{key:"001110",value:4e4},{key:"010110",value:4e4},{key:"011010",value:4e4},{key:"011100",value:4e4},{key:"1010101",value:4e4},{key:"11001011",value:4e4},{key:"11010011",value:4e4},{key:"111000111",value:4e4},{key:"01111",value:35e3},{key:"10111",value:35e3},{key:"11011",value:35e3},{key:"11101",value:35e3},{key:"11110",value:35e3},{key:"01110",value:35e3},{key:"111",value:8e3},{key:"1011",value:7e3},{key:"1101",value:7e3},{key:"10101",value:6e3},{key:"10011",value:6e3},{key:"11001",value:6e3},{key:"0110",value:900},{key:"11",value:800},{key:"101",value:700},{key:"1001",value:600},{key:"010",value:90},{key:"1",value:80},{key:"0",value:70}];function G(t,e,n,r){var o=function(e,n){var r,o;return null!==(r=null==t||null===(o=t[e])||void 0===o?void 0:o[n])&&void 0!==r?r:-1},i=0,a=o(n,r);if(0==a||a==e){var s=[];[[0,1],[1,0],[1,1],[1,-1]].forEach((function(t){var i=H(t,2),a=i[0],c=i[1],l=[];l.push(1);for(var u=1;u<5;u++){var f=o(n-u*a,r-u*c);if(![0,e].includes(f))break;l.unshift(f?1:0)}for(var h=1;h<5;h++){var d=o(n+h*a,r+h*c);if(![0,e].includes(d))break;l.push(d?1:0)}l.length>=5&&s.push(l.join(""))})),s.forEach((function(t){var e,n=_(F);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(t.includes(r.key)){i+=r.value;break}}}catch(t){n.e(t)}finally{n.f()}i+=t.length-5}))}return i}function q(t,e){var n=function(t,e){for(var n=[],r=0;r<t.length;r++)for(var o=0;o<t[r].length;o++){var i=G(t,e,r,o);n.push({x:r,y:o,score:i})}n.sort((function(t,e){return e.score-t.score}));var a=n[0].score,s=n.filter((function(t){return t.score==a}));return s[Math.floor(Math.random()*s.length)]},r=n(t,e);console.log("[bestCoord]",r);var o=n(t,1==e?2:1);return console.log("[nextCoord]",o),o.score>r.score&&o.score-r.score>4e3&&(r={x:o.x,y:o.y,score:9e4}),r}var U=new z("canvas"),N="waiting",J="black",K="white",X="player",Y=Date.now(),Q=720,Z=30,tt=null,et=0,nt=null,rt=U.createStage({backgroundColor:"#529888"}),ot=rt.createMap({x:50,y:50,pxWidth:36,data:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],update:function(){this.status="doing"==N&&"player"==X?1:2},draw:function(t){var e=this.pxWidth;t.save(),t.translate(this.x+.5*e,this.y+.5*e),t.fillStyle="#d9af74",t.fillRect(-e,-e,(this.xLength+1)*e,(this.yLength+1)*e),t.fillStyle="#261e19",t.strokeStyle="#261e19",t.lineWidth=1,t.font="14px Arial",t.textAlign="center",t.textBaseline="middle";for(var n=0;n<this.xLength;n++)t.beginPath(),t.fillText(W[n],-.5*e,n*e),t.moveTo(0,n*e),t.lineTo((this.xLength-1)*e,n*e),t.closePath(),t.stroke();for(var r=0;r<this.yLength;r++)t.beginPath(),t.fillText(C[r],r*e,-.5*e),t.moveTo(r*e,0),t.lineTo(r*e,(this.yLength-1)*e),t.closePath(),t.stroke();var o=function(n,r){t.save(),t.beginPath(),t.arc(n*e,r*e,.125*e,0,2*Math.PI),t.closePath(),t.fill(),t.restore()};o(7,7),o(3,3),o(11,3),o(3,11),o(11,11),1==this.status&&this.coord&&function(t,e){var n=e.x,r=e.y,o=e.size,i=e.color,a=void 0===i?"#ec7c78":i;t.save(),t.strokeStyle=a,t.lineWidth=2,t.beginPath(),t.moveTo(n-.4*o,r-.2*o),t.lineTo(n-.2*o,r-.2*o),t.lineTo(n-.2*o,r-.4*o),t.stroke(),t.moveTo(n+.4*o,r-.2*o),t.lineTo(n+.2*o,r-.2*o),t.lineTo(n+.2*o,r-.4*o),t.stroke(),t.moveTo(n-.4*o,r+.2*o),t.lineTo(n-.2*o,r+.2*o),t.lineTo(n-.2*o,r+.4*o),t.stroke(),t.moveTo(n+.4*o,r+.2*o),t.lineTo(n+.2*o,r+.2*o),t.lineTo(n+.2*o,r+.4*o),t.stroke(),t.closePath(),t.restore()}(t,{x:this.coord.x*e,y:this.coord.y*e,size:e}),t.restore()}});rt.createItem({x:640,y:32,update:function(){if("doing"==N)if(Q>0&&Z>0){var t=Date.now(),e=Math.floor((t-Y)/1e3);e&&"player"==X&&(Q-=e,Z-=e,Y=t)}else et+=-1,N="finished",tt={type:"lose",msg:"🕒已超时！"},at.status=1,st.status=1},draw:function(t){t.save(),t.translate(this.x,this.y),R(t,{x:0,y:0,width:288,height:210});var e=t.createLinearGradient(0,0,288,60);if(e.addColorStop(0,"#f5deb4"),e.addColorStop(.45,"#f5deb4"),e.addColorStop(.55,"#ce8a43"),e.addColorStop(1,"#ce8a43"),R(t,{x:0,y:0,width:288,height:60,color:e}),L(t,{x:30,y:31,size:ot.pxWidth,color:K,text:"black"==K?"黑":"白"}),L(t,{x:258,y:31,size:ot.pxWidth,color:J,text:"black"==J?"黑":"白"}),B(t,{x:60,y:31,size:24,align:"left",text:"电脑"}),B(t,{x:144,y:31,size:20,color:"#fc9000",text:"VS"}),B(t,{x:228,y:31,size:24,align:"right",text:"玩家"}),B(t,{x:60,y:120,size:20,align:"left",text:"单局计时"}),D(t,{x:150,y:120,size:24,text:I(Q)}),B(t,{x:60,y:165,size:20,align:"left",text:"单步计时"}),D(t,{x:150,y:165,size:24,text:I(Z)}),"doing"==N){var n=6*Math.cos(this.times/24);B(t,"computer"==X?{x:80,y:64+n,size:32,text:"👆🏻"}:{x:208,y:64+n,size:32,text:"👆🏻"})}t.restore()}}),rt.createItem({x:640,y:548,draw:function(t){t.save(),t.translate(this.x,this.y),R(t,{x:0,y:0,width:288,height:60}),B(t,{x:25,y:30,size:20,align:"left",text:"玩家得分："}),B(t,{x:125,y:30,size:24,align:"left",text:et,color:"#fc9000"}),t.restore()}});var it=rt.createItem({x:895,y:578,width:40,height:40,dynamic:!0,align:["center","center"],draw:function(t){t.save(),B(t,{x:this.x,y:this.y+2,size:32,text:"↻",color:this.isHover?"#cccccc":"#ffffff"}),t.restore()}}),at=rt.createItem({x:784,y:350,width:96,height:40,dynamic:!0,align:["center","center"],draw:function(t){1==this.status&&(t.save(),B(t,{x:this.x,y:this.y,size:24,text:"waiting"==N?"准备开始":tt?tt.msg:""}),t.restore())}}),st=rt.createItem({x:784,y:425,width:130,height:48,dynamic:!0,align:["center","center"],draw:function(t){1==this.status&&(t.save(),function(t,e){var n=e.x,r=e.y,o=e.size,i=e.text,a=e.color,s=void 0===a?"#fc9000":a;t.save(),t.font="bold ".concat(o,"px Arial"),t.textAlign="center",t.textBaseline="middle";var c=t.measureText(i).width;R(t,{x:n-c/2-25,y:r-1.2*o,width:c+50,height:2.4*o,radius:1.2*o,color:s}),t.strokeStyle="rgba(0,0,0,0.35)",t.fillStyle="#fff",t.lineWidth=3,t.strokeText(i,n,r),t.fillText(i,n,r),t.restore()}(t,{x:this.x,y:this.y,size:24,text:"waiting"==N?"开始游戏":"继续游戏",color:this.isHover?"#eb8600":"#fc9000"}),t.restore())}}),ct=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"player",e=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r="player"==t?J:K,o=A.indexOf(t);return nt={x:e,y:n},ot.setValue(e,n,o),rt.createItem({type:"piece",location:ot,coord:{x:e,y:n},draw:function(e){var n=this.x,o=this.y;L(e,{x:n,y:o,size:ot.pxWidth,color:r}),"doing"==N&&"computer"==t&&this.coord.x==nt.x&&this.coord.y==nt.y&&function(t,e){var n=e.x,r=e.y,o=e.size,i=e.color,a=void 0===i?"#ec7c78":i;t.save(),t.strokeStyle=a,t.lineWidth=2,t.beginPath(),t.moveTo(n-.2*o,r),t.lineTo(n+.2*o,r),t.stroke(),t.moveTo(n,r-.2*o),t.lineTo(n,r+.2*o),t.stroke(),t.closePath(),t.restore()}(e,{x:n,y:o,size:ot.pxWidth})}})};rt.createItem({type:"mark",x:ot.x,y:ot.y,zindex:999,draw:function(t){var e=ot.pxWidth;(t.save(),t.translate(this.x+.5*e,this.y+.5*e),"finished"==N)&&function(t,e){for(var n=function(e,n){var r,o;return null!==(r=null==t||null===(o=t[e])||void 0===o?void 0:o[n])&&void 0!==r?r:-1},r=[],o=function(e){for(var o=function(t){var o=n(e,t);o>0&&[[1,0],[0,1],[1,1],[-1,1]].forEach((function(i){var a=H(i,2),s=a[0],c=a[1],l=[];l.push(1);for(var u=1;u<5;u++)n(e+u*s,t+u*c)==o&&l.push(1);5==l.length&&r.push({start:{x:e,y:t},end:{x:e+4*s,y:t+4*c},value:o})}))},i=0;i<t[e].length;i++)o(i)},i=0;i<t.length;i++)o(i);return r}(ot.data).forEach((function(n){!function(t,e){var n=e.x1,r=e.y1,o=e.x2,i=e.y2,a=e.color,s=void 0===a?"#ec7c78":a;t.save(),t.strokeStyle=s,t.lineWidth=3,t.beginPath(),t.moveTo(n,r),t.lineTo(o,i),t.stroke(),t.closePath(),t.restore()}(t,{x1:n.start.x*e,y1:n.start.y*e,x2:n.end.x*e,y2:n.end.y*e})}));t.restore()}});var lt=function(){X="computer",Y=Date.now();var t=A.indexOf(X),e=q(ot.data,t);0==e.score?(et+=0,N="finished",tt={type:"lose",msg:"😐平局了！"},at.status=1,st.status=1):setTimeout((function(){ct(X,e.x,e.y),console.log("[电脑落子]",C[e.x],W[e.y]),e.score>=9e5?(et+=-1,N="finished",tt={type:"lose",msg:"😭你输了！"},at.status=1,st.status=1):ut()}),500)},ut=function(){X="player",Y=Date.now(),Z=30;var t=A.indexOf(X);0==q(ot.data,t).score&&(et+=0,N="finished",tt={type:"lose",msg:"😐平局了！"},at.status=1,st.status=1)};rt.on("mousemove",(function(){ot.coord=null})),ot.on("mousemove",(function(t){ot.coord=ot.position2coord(t.x,t.y)})),ot.on("click",(function(t){if(ot.coord=ot.position2coord(t.x,t.y),0==ot.getValue(ot.coord.x,ot.coord.y)){ct("player",ot.coord.x,ot.coord.y),console.log("[玩家落子]",C[ot.coord.x],W[ot.coord.y]);var e=A.indexOf("player");G(ot.data,e,ot.coord.x,ot.coord.y)>=9e5?(et+=1,N="finished",tt={type:"win",msg:"😃你赢了！"},at.status=1,st.status=1):lt()}})),st.on("click",(function(){N="doing",J=Math.random()>.5?"black":"white",K="black"!=J?"black":"white",Y=Date.now(),Q=720,Z=30,rt.clearItems("piece"),rt.reset(),at.status=2,st.status=2,"black"==J?ut():lt()})),it.on("click",(function(){et=0,alert("玩家得分已重置！")})),U.init()}));
